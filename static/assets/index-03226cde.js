import{K as s,c as Q,r as h,J as p,a0 as w,B as I,U as k,a5 as y,a1 as x}from"./index-a78e1d6d.js";import{R as W}from"./Row-7b588485.js";import{C as R}from"./Col-71b6a57a.js";import{k as b,P as X,u as Z,F as _,I as v,n as ee}from"./App-efc1b7be.js";import{I as se}from"./Input-c0987a3f.js";import{L as re}from"./Label-04986467.js";import{A as ae}from"./AppCard-5dd622ab.js";import{T as te}from"./Table-425d6904.js";import{A as B}from"./AdminButton-84e07a20.js";import{a as A}from"./ToastComponent-995c97dd.js";import"./Card-d18638bb.js";import"./CardBody-d3a746c0.js";import"./CardTitle-4fff166c.js";function ie({children:f,left:n}){return s("div",{className:Q("divider",{"divider-left":n}),children:s("div",{className:"divider-text text-left",children:f})})}const ne={title:"User Member",read:"view_user",create:"add_user",update:"update_user",delete:"delete_user"},oe={title:"User Role",read:"view_user_role",create:"add_user_role",update:"update_user_role",delete:"delete_user_role"},le=[ne,oe],de={administrator:le},ce=de;function pe({permissions:f,values:n,handleChange:d}){return s(h.Fragment,{children:s(te,{responsive:!0,className:"permission_table ",children:s("tbody",{children:f.map((r,t)=>p("tr",{children:[s("td",{className:"text-nowrap",children:r.title}),s("td",{children:s(b,{id:r.read,type:"checkbox",label:"View",disabled:!r.read,checked:n.includes(r.read),onChange:()=>d(r.read)})}),s("td",{children:s(b,{id:r.create,type:"checkbox",label:"Create",disabled:!r.create,checked:n.includes(r.create),onChange:()=>d(r.create)})}),s("td",{children:s(b,{id:r.update,type:"checkbox",label:"Update",disabled:!r.update,checked:n.includes(r.update),onChange:()=>d(r.update)})}),s("td",{children:s(b,{disabled:!r.delete,id:r.delete,type:"checkbox",label:"Delete",checked:n.includes(r.delete),onChange:()=>d(r.delete)})})]},t))})})})}function me(){const{roleType:f,id:n}=X(),d=Z(),r=ce.administrator,[t,m]=h.useState({name:"",permissions:[]}),[u,g]=h.useState(!1),[F,S]=h.useState(!1),T=e=>a=>{m({...t,[e]:a.target.value})},L=e=>{const a=t.permissions;if(a.includes(e)){const o=a.filter(l=>l!==e);m({...t,permissions:o})}else a.push(e),m({...t,permissions:a});S(!1)},j=r.map(e=>e.read?{perm:e.read}:"no"),D=r.map(e=>e.create?{perm:e.create}:"no"),E=r.map(e=>e.update?{perm:e.update}:"no"),z=r.map(e=>e.delete?{perm:e.delete}:"no"),H=[...j,...D,...E,...z],M=H.filter(e=>e.perm),O=M.map(e=>e.perm),V=()=>{m({...t,permissions:O}),S(!0)},G=()=>`${x}/api/role/`,N=()=>`${x}/api/role/${n}/`,U=()=>`${x}/api/permissions/`,J=n?"put":"post",K=n?N():G(),$=()=>{g(!0),k.get(U(),y).then(e=>{const a=[];for(let i=0;i<t.permissions.length;i++){const c=e.data.filter(C=>C.code===t.permissions[i]);a.push(c[0]?{id:c[0].id}:"perm")}const o=a.filter(i=>i.id),l=o.map(i=>i.id),P={name:t.name,permission:l};k[J](K,P,y).then(()=>{A("success",v,`Successfully ${n?"updated":"created"}`),d.push(`/${f}-roles`),g(!1)}).catch(i=>{if(console.log(i.response),i.response&&i.response.status===400)for(const[c,C]of Object.entries(i.response.data))c==="password"?(payload.setPassErrors(C),A("error",v,"Invalid password")):A("error",v,`${ee(c)}: ${C}`);g(!1)})}).then(()=>{g(!1)})},Y=e=>{k.get(N(),y).then(a=>{if(a.data.permission&&a.data.permission.length)if(console.log("res.data.permission",typeof a.data.permission[0]),typeof a.data.permission[0]=="number"){console.log("perms",e);let o=[];for(let l=0;l<a.data.permission.length;l++){console.log(e);const P=e.find(i=>i.id===a.data.permission[l]);if(o.push(P),console.log("permArray",o),o.length&&o[0]){const i={name:a.data.name,permissions:o.map(c=>c.code)};m(i)}}}else{const o={name:a.data.name,permissions:a.data.permission.map(l=>l.code)};m(o)}})},q=()=>{k.get(U(),y).then(e=>{Y(e.data)})};return h.useEffect(()=>{n&&q()},[]),p(ae,{body:!0,children:[p(W,{children:[s(R,{md:"3",children:p(_,{children:[s(re,{children:"Name"}),s(se,{placeholder:"Name",onChange:T("name"),value:t.name})]})}),s(R,{md:"9",className:"text-right",children:p(_,{children:[p(B,{onClick:()=>$(),disabled:!t.name||!t.permissions.length||u,children:["Submit ",u&&s(w,{size:"sm"})]})," ",s(I,{disabled:u,outline:!0,onClick:()=>d.goBack(),children:"Cancel"})]})})]}),s(ie,{children:"Permission"}),s(_,{children:s(b,{checked:F,type:"checkbox",label:"Select all",id:"select-all",onChange:()=>V()})}),s(pe,{permissions:r,values:t.permissions,handleChange:L}),s("br",{}),p(B,{onClick:()=>$(),disabled:!t.name||!t.permissions.length||u,children:["Submit ",u&&s(w,{size:"sm"})]})," ",s(I,{disabled:u,outline:!0,onClick:()=>d.goBack(),children:"Cancel"})]})}function Se(){return s(h.Fragment,{children:s(me,{})})}export{Se as default};
