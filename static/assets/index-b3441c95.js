import{F as s,c as Q,r as h,P as p,a5 as U,B as D,Y as k,aa as y,ap as P,I as x,as as W,a6 as v}from"./index-52a95e7f.js";import{R as X}from"./Row-9c9cf5c4.js";import{C as F}from"./Col-ea297bd2.js";import{o as b,K as Z,u as ee,F as S,I as se,D as I}from"./App-a255ea7a.js";import{L as ae}from"./Label-e92a3cb1.js";import{A as re}from"./AppCard-866ccf7b.js";import{T as te}from"./Table-e685a4c1.js";import"./CardBody-2b451391.js";import"./CardHeader-79643d0f.js";import"./CardTitle-f2916fda.js";function ne({children:f,left:i}){return s("div",{className:Q("divider",{"divider-left":i}),children:s("div",{className:"divider-text text-left",children:f})})}const ie={title:"User Member",read:"view_user",create:"add_user",update:"update_user",delete:"delete_user"},de={title:"User Role",read:"view_user_role",create:"add_user_role",update:"update_user_role",delete:"delete_user_role"},le={title:"Department",read:"view_department",create:"add_department",update:"update_department",delete:"delete_department"},oe=[ie,de,le],ce={administrator:oe},pe=ce;function me({permissions:f,values:i,handleChange:o}){return s(h.Fragment,{children:s(te,{responsive:!0,className:"permission_table ",children:s("tbody",{children:f.map((a,t)=>p("tr",{children:[s("td",{className:"text-nowrap",children:a.title}),s("td",{children:s(b,{id:a.read,type:"checkbox",label:"View",disabled:!a.read,checked:i.includes(a.read),onChange:()=>o(a.read)})}),s("td",{children:s(b,{id:a.create,type:"checkbox",label:"Create",disabled:!a.create,checked:i.includes(a.create),onChange:()=>o(a.create)})}),s("td",{children:s(b,{id:a.update,type:"checkbox",label:"Update",disabled:!a.update,checked:i.includes(a.update),onChange:()=>o(a.update)})}),s("td",{children:s(b,{disabled:!a.delete,id:a.delete,type:"checkbox",label:"Delete",checked:i.includes(a.delete),onChange:()=>o(a.delete)})})]},t))})})})}function ue(){const{roleType:f,id:i}=Z(),o=ee(),a=pe.administrator,[t,m]=h.useState({name:"",permissions:[]}),[u,g]=h.useState(!1),[R,A]=h.useState(!1),B=e=>r=>{m({...t,[e]:r.target.value})},T=e=>{const r=t.permissions;if(r.includes(e)){const d=r.filter(l=>l!==e);m({...t,permissions:d})}else r.push(e),m({...t,permissions:r});A(!1)},L=a.map(e=>e.read?{perm:e.read}:"no"),j=a.map(e=>e.create?{perm:e.create}:"no"),E=a.map(e=>e.update?{perm:e.update}:"no"),z=a.map(e=>e.delete?{perm:e.delete}:"no"),H=[...L,...j,...E,...z],M=H.filter(e=>e.perm),O=M.map(e=>e.perm),V=()=>{m({...t,permissions:O}),A(!0)},Y=()=>`${v}/api/role/`,w=()=>`${v}/api/role/${i}/`,N=()=>`${v}/api/permissions/`,G=i?"put":"post",K=i?w():Y(),$=()=>{g(!0),k.get(N(),y).then(e=>{const r=[];for(let n=0;n<t.permissions.length;n++){const c=e.data.filter(C=>C.code===t.permissions[n]);r.push(c[0]?{id:c[0].id}:"perm")}const d=r.filter(n=>n.id),l=d.map(n=>n.id),_={name:t.name,permission:l};k[G](K,_,y).then(()=>{P("success",x,`Successfully ${i?"updated":"created"}`),o.push(`/${f}-roles`),g(!1)}).catch(n=>{if(console.log(n.response),n.response&&n.response.status===400)for(const[c,C]of Object.entries(n.response.data))c==="password"?(payload.setPassErrors(C),P("error",x,"Invalid password")):P("error",x,`${W(c)}: ${C}`);g(!1)})}).then(()=>{g(!1)})},q=e=>{k.get(w(),y).then(r=>{if(r.data.permission&&r.data.permission.length)if(console.log("res.data.permission",typeof r.data.permission[0]),typeof r.data.permission[0]=="number"){console.log("perms",e);let d=[];for(let l=0;l<r.data.permission.length;l++){console.log(e);const _=e.find(n=>n.id===r.data.permission[l]);if(d.push(_),console.log("permArray",d),d.length&&d[0]){const n={name:r.data.name,permissions:d.map(c=>c.code)};m(n)}}}else{const d={name:r.data.name,permissions:r.data.permission.map(l=>l.code)};m(d)}})},J=()=>{k.get(N(),y).then(e=>{q(e.data)})};return h.useEffect(()=>{i&&J()},[]),p(re,{body:!0,children:[p(X,{children:[s(F,{md:"3",children:p(S,{children:[s(ae,{children:"Name"}),s(se,{placeholder:"Name",onChange:B("name"),value:t.name})]})}),s(F,{md:"9",className:"text-right",children:p(S,{children:[p(I,{onClick:()=>$(),disabled:!t.name||!t.permissions.length||u,children:["Submit ",u&&s(U,{size:"sm"})]})," ",s(D,{disabled:u,outline:!0,onClick:()=>o.goBack(),children:"Cancel"})]})})]}),s(ne,{children:"Permission"}),s(S,{children:s(b,{checked:R,type:"checkbox",label:"Select all",id:"select-all",onChange:()=>V()})}),s(me,{permissions:a,values:t.permissions,handleChange:T}),s("br",{}),p(I,{onClick:()=>$(),disabled:!t.name||!t.permissions.length||u,children:["Submit ",u&&s(U,{size:"sm"})]})," ",s(D,{disabled:u,outline:!0,onClick:()=>o.goBack(),children:"Cancel"})]})}function ve(){return s(h.Fragment,{children:s(ue,{})})}export{ve as default};
