import{L as s,c as J,r as h,K as p,a1 as U,B as R,V as k,a6 as y,a2 as P}from"./index-2d311879.js";import{R as W}from"./Row-baaf3703.js";import{C as B}from"./Col-e0c46088.js";import{m as b,Q as X,u as Z,F as _,I as ee,b as v,n as se}from"./App-2483e876.js";import{L as re}from"./Label-a41942c5.js";import{A as ae}from"./AppCard-487527ab.js";import{T as te}from"./Table-424cb917.js";import{D}from"./DealerAdminButton-4fadf9af.js";import{a as S}from"./ToastComponent-231ab741.js";import"./Card-0873846d.js";import"./CardBody-4add9265.js";import"./CardTitle-7e91e84e.js";function ne({children:f,left:i}){return s("div",{className:J("divider",{"divider-left":i}),children:s("div",{className:"divider-text text-left",children:f})})}const ie={title:"User Member",read:"view_user",create:"add_user",update:"update_user",delete:"delete_user"},oe={title:"User Role",read:"view_user_role",create:"add_user_role",update:"update_user_role",delete:"delete_user_role"},le=[ie,oe],de={administrator:le},ce=de;function pe({permissions:f,values:i,handleChange:d}){return s(h.Fragment,{children:s(te,{responsive:!0,className:"permission_table ",children:s("tbody",{children:f.map((r,t)=>p("tr",{children:[s("td",{className:"text-nowrap",children:r.title}),s("td",{children:s(b,{id:r.read,type:"checkbox",label:"View",disabled:!r.read,checked:i.includes(r.read),onChange:()=>d(r.read)})}),s("td",{children:s(b,{id:r.create,type:"checkbox",label:"Create",disabled:!r.create,checked:i.includes(r.create),onChange:()=>d(r.create)})}),s("td",{children:s(b,{id:r.update,type:"checkbox",label:"Update",disabled:!r.update,checked:i.includes(r.update),onChange:()=>d(r.update)})}),s("td",{children:s(b,{disabled:!r.delete,id:r.delete,type:"checkbox",label:"Delete",checked:i.includes(r.delete),onChange:()=>d(r.delete)})})]},t))})})})}function me(){const{roleType:f,id:i}=X(),d=Z(),r=ce.administrator,[t,m]=h.useState({name:"",permissions:[]}),[u,g]=h.useState(!1),[F,A]=h.useState(!1),I=e=>a=>{m({...t,[e]:a.target.value})},L=e=>{const a=t.permissions;if(a.includes(e)){const o=a.filter(l=>l!==e);m({...t,permissions:o})}else a.push(e),m({...t,permissions:a});A(!1)},T=r.map(e=>e.read?{perm:e.read}:"no"),j=r.map(e=>e.create?{perm:e.create}:"no"),E=r.map(e=>e.update?{perm:e.update}:"no"),V=r.map(e=>e.delete?{perm:e.delete}:"no"),z=[...T,...j,...E,...V],H=z.filter(e=>e.perm),M=H.map(e=>e.perm),O=()=>{m({...t,permissions:M}),A(!0)},G=()=>`${P}/api/role/`,N=()=>`${P}/api/role/${i}/`,$=()=>`${P}/api/permissions/`,K=i?"put":"post",Q=i?N():G(),w=()=>{g(!0),k.get($(),y).then(e=>{const a=[];for(let n=0;n<t.permissions.length;n++){const c=e.data.filter(C=>C.code===t.permissions[n]);a.push(c[0]?{id:c[0].id}:"perm")}const o=a.filter(n=>n.id),l=o.map(n=>n.id),x={name:t.name,permission:l};k[K](Q,x,y).then(()=>{S("success",v,`Successfully ${i?"updated":"created"}`),d.push(`/${f}-roles`),g(!1)}).catch(n=>{if(console.log(n.response),n.response&&n.response.status===400)for(const[c,C]of Object.entries(n.response.data))c==="password"?(payload.setPassErrors(C),S("error",v,"Invalid password")):S("error",v,`${se(c)}: ${C}`);g(!1)})}).then(()=>{g(!1)})},Y=e=>{k.get(N(),y).then(a=>{if(a.data.permission&&a.data.permission.length)if(console.log("res.data.permission",typeof a.data.permission[0]),typeof a.data.permission[0]=="number"){console.log("perms",e);let o=[];for(let l=0;l<a.data.permission.length;l++){console.log(e);const x=e.find(n=>n.id===a.data.permission[l]);if(o.push(x),console.log("permArray",o),o.length&&o[0]){const n={name:a.data.name,permissions:o.map(c=>c.code)};m(n)}}}else{const o={name:a.data.name,permissions:a.data.permission.map(l=>l.code)};m(o)}})},q=()=>{k.get($(),y).then(e=>{Y(e.data)})};return h.useEffect(()=>{i&&q()},[]),p(ae,{body:!0,children:[p(W,{children:[s(B,{md:"3",children:p(_,{children:[s(re,{children:"Name"}),s(ee,{placeholder:"Name",onChange:I("name"),value:t.name})]})}),s(B,{md:"9",className:"text-right",children:p(_,{children:[p(D,{onClick:()=>w(),disabled:!t.name||!t.permissions.length||u,children:["Submit ",u&&s(U,{size:"sm"})]})," ",s(R,{disabled:u,outline:!0,onClick:()=>d.goBack(),children:"Cancel"})]})})]}),s(ne,{children:"Permission"}),s(_,{children:s(b,{checked:F,type:"checkbox",label:"Select all",id:"select-all",onChange:()=>O()})}),s(pe,{permissions:r,values:t.permissions,handleChange:L}),s("br",{}),p(D,{onClick:()=>w(),disabled:!t.name||!t.permissions.length||u,children:["Submit ",u&&s(U,{size:"sm"})]})," ",s(R,{disabled:u,outline:!0,onClick:()=>d.goBack(),children:"Cancel"})]})}function Se(){return s(h.Fragment,{children:s(me,{})})}export{Se as default};
